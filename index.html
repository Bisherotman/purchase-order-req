<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="ุจูุงุจุฉ ุชุณุฌูู ูุฅุฏุงุฑุฉ ุทูุจุงุช ุงูุดุฑุงุก ููุณู ุงููุดุงุฑูุน โ ุดุฑูุฉ ุจูุช ุงูุฅุจุงุก">
  <title>ุจูุงุจุฉ ุทูุจุงุช ุงูุดุฑุงุก | ุงููุดุงุฑูุน</title>


  <!-- ุฃููููุฉ ุงููููุน -->
  <link rel="icon" href="img/pagelogo.png" type="image/png" />
  <!-- ููู ุงูุชูุณููุงุช ุงูุฃุณุงุณู -->
  <link rel="stylesheet" href="style.css">
    <!-- ููู ุงููุญุชูู ุงูุฃุณุงุณู -->
  <script src="main.js" defer></script>

  <!-- ุฎุทูุท -->
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Tajawal:wght@400;600;700&display=swap"
    rel="stylesheet">
</head>


<body class="auth-out">


  <header>
    <nav class="nav">
      <a class="brand" href="#/login" id="brandLink">
        <img src="img/pagelogo.png" alt="Bayt Alebaa Logo" />
      </a>
      <div class="title">
        <span class="ar">ุจูุงุจุฉ ุทูุจุงุช ุงูุดุฑุงุก ููุณู ุงููุดุงุฑูุน</span>
        <span class="en">Projects Department Purchase Order Portal</span>
      </div>
      <div class="navlinks" id="navLinks">
        <a href="#/new" data-auth="user" style="display:none">ุทูุจ ุฌุฏูุฏ</a>
        <a href="#/my" data-auth="user" style="display:none">ุทูุจููุงุชู</a>
        <a href="#/admin" data-auth="admin" style="display:none">ุฅุฏุงุฑุฉ ุงูุทูุจุงุช</a>
        <a href="#/login" id="sessionBtn">ุฏุฎูู</a>
      </div>
    </nav>
  </header>

  <main class="container">

    <!-- LOGIN -->
    <section id="view-login" class="view active">
      <div class="card">
        <h2>ุชุณุฌูู ุงูุฏุฎูู</h2>
        <form id="loginForm">
          <label for="loginEmail">ุงูุฅูููู</label>
          <div class="input-wrap">
            <input id="loginEmail" type="email" placeholder="example@baytalebaa.com" inputmode="email"
              autocomplete="username" />
            <button type="button" id="clearEmail" class="input-clear">โ</button>
          </div>

          <label for="loginPassword" style="margin-top:14px">ูููุฉ ุงููุฑูุฑ</label>
          <div class="pwd-wrap input-wrap">
            <input id="loginPassword" type="password" required placeholder="โขโขโขโขโขโขโขโข" />
            <button type="button" class="pwd-toggle" id="togglePwd" aria-label="ุฅุธูุงุฑ/ุฅุฎูุงุก ูููุฉ ุงููุฑูุฑ">๐๏ธ</button>
            <button type="button" class="pwd-clear" id="clearPwd" aria-label="ูุณุญ ูููุฉ ุงููุฑูุฑ">โ</button>
          </div>

          <label style="display:flex;gap:8px;align-items:center;margin-top:10px;font-weight:400">
            <input id="rememberEmail" type="checkbox" style="width:18px;height:18px" />
            <span class="helper">ุชุฐููุฑ ุงูุฅูููู</span>
          </label>

          <button type="submit" id="loginBtn" class="btn-strong" style="margin-top:10px">ุฏุฎูู</button>
          <div id="loginMsg" class="msg"></div>
          <div class="helper">* ุฅูุดุงุก ุงูุญุณุงุจุงุช ูุชู ุนุจุฑ ุงูุฅุฏุงุฑุฉ ููุท.</div>
        </form>
      </div>
    </section>

    <!-- NEW ORDER -->
    <section id="view-new" class="view">
      <div class="card">
        <div class="row" style="justify-content:space-between">
          <h2>ุชุณุฌูู ุทูุจ ุดุฑุงุก</h2>
          <div class="helper" id="whoami"></div>
        </div>

        <!-- ูุนูููุงุช ุงููุดุฑูุน -->
        <div class="section-box">ูุนูููุงุช ุงููุดุฑูุน</div>
        <div class="row">
          <div>
            <label for="projectName">ุงุณู ุงููุดุฑูุน</label>
            <input id="projectName" type="text" placeholder="...ูุดุฑูุน ุฃุจุฑุงุฌ" required />
          </div>
          <div>
            <label for="customerName">ุงุณู ุงูุนููู</label>
            <input id="customerName" type="text" placeholder="...ุงุณู ุงูุนููู" required />
          </div>
        </div>

        <!-- ุงูุฃุตูุงู -->
        <div class="section-box">ุงูุฃุตูุงู</div>
        <div class="items-head">
          <button type="button" id="addItemBtn" class="add-item">+ ุฅุถุงูุฉ ุตูู</button>
        </div>
        <div id="itemsWrap">
          <!-- ูุชู ุชูููุฏ ุงูุฃุตูุงู ููุง ุนุจุฑ JavaScript -->
        </div>

        <!-- ุงููุฑููุงุช -->
        <label style="font-weight:700; display:block; margin-top:14px;">
          ุฑูุงุจุท ุงููุฑููุงุช (ุญุฏ ุฃูุตู 3)
        </label>
        <div id="linksWrap"></div>
        <button type="button" id="addLinkBtn" class="add-item">+ ุฅุถุงูุฉ ุฑุงุจุท</button>

        <!-- ุฅุฑุณุงู ุงูุทูุจ -->
        <button type="button" id="submitOrder" class="btn-strong" style="margin-top:10px;">
          ุฅุฑุณุงู ุงูุทูุจ
        </button>
        <div id="newMsg" class="msg"></div>
      </div>
    </section>

    <!-- MY ORDERS -->
    <section id="view-my" class="view">
      <div class="card">
        <div class="row" style="justify-content:space-between">
          <h2>ุทูุจููุงุชู</h2>
          <div class="helper" id="whoamiMy">โ</div>
        </div>

        <div class="filters">
          <input id="mySearch" class="chip-input" placeholder="ุงุจุญุซ ุจุฑูู ุงูุชุชุจูุนุ ููุฏ ุงูุตููุ ุงุณู ุงููุดุฑูุน ุฃู ุงูุนููู" />

          <select id="myFilterStatus" class="chip-select" title="ุงูุญุงูุฉ">
            <option value="">ูู ุงูุญุงูุงุช</option>
            <option value="created">ุฌุฏูุฏ</option>
            <option value="ordered">ุชู ุงูุทูุจ ูู ุงููุตูุน</option>
            <option value="shipped">ุชู ุงูุดุญู</option>
            <option value="delivered">ูุตูุช</option>
          </select>

          <select id="mySort" class="chip-select" title="ุงูุชุฑุชูุจ">
            <option value="createdAt_desc">ุงูุฃุญุฏุซ ุฃููุงู</option>
            <option value="createdAt_asc">ุงูุฃูุฏู ุฃููุงู</option>
          </select>
        </div>

        <div id="myTableWrap" class="card" style="padding:0">
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>ุงูุชุชุจูุน</th>
                  <th>ุงูุตูู</th>
                  <th>ุงููููุฉ</th>
                  <th>ุงูุณุนุฑ</th>
                  <th>ุงููุดุฑูุน</th>
                  <th>ุงูุญุงูุฉ</th>
                  <th>ุงูุชุงุฑูุฎ</th>
                  <th>ุชูุงุตูู</th>
                </tr>
              </thead>
              <tbody id="myOrdersBody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <!-- ADMIN -->
    <section id="view-admin" class="view">
      <div class="card">
        <div class="row" style="justify-content:space-between">
          <h2>ุฅุฏุงุฑุฉ ุงูุทูุจุงุช</h2>
          <div class="helper" id="whoamiAdmin">โ</div>
        </div>

        <div class="filters">
          <input id="adminSearch" class="chip-input"
            placeholder="ุงุจุญุซ ุจุฑูู ุงูุชุชุจูุนุ ููุฏ ุงูุตููุ ุงุณู ุงููุดุฑูุน ุฃู ุงูุนููู" />

          <select id="adminFilterBranch" class="chip-select" title="ุงููุฑุน">
            <option value="">ูู ุงููุฑูุน</option>
            <option>Riyadh</option>
            <option>Dammam</option>
            <option>Jeddah</option>
            <option>Makkah</option>
            <option>Madina</option>
            <option>HQ</option>
          </select>

          <select id="adminFilterStatus" class="chip-select" title="ุงูุญุงูุฉ">
            <option value="">ูู ุงูุญุงูุงุช</option>
            <option value="created">ุฌุฏูุฏ</option>
            <option value="ordered">ุชู ุงูุทูุจ ูู ุงููุตูุน</option>
            <option value="shipped">ุชู ุงูุดุญู</option>
            <option value="delivered">ูุตูุช</option>
          </select>

          <select id="adminFilterUser" class="chip-select" title="ุงููุณุชุฎุฏู">
            <option value="">ูู ุงููุณุชุฎุฏููู</option>
          </select>

          <select id="adminSort" class="chip-select" title="ุงูุชุฑุชูุจ">
            <option value="createdAt_desc">ุงูุฃุญุฏุซ ุฃููุงู</option>
            <option value="createdAt_asc">ุงูุฃูุฏู ุฃููุงู</option>
          </select>
        </div>

        <div id="adminTableWrap" class="card" style="padding:0">
          <div class="table-wrap">
            <table id="ordersTable">
              <thead>
                <tr>
                  <th>ุฑูู</th>
                  <th>ุงูุชุงุฑูุฎ</th>
                  <th>ุงููุดุฑูุน</th>
                  <th>ุงููุณุชุฎุฏู</th>
                  <th>ุงูุญุงูุฉ</th>
                  <th>ุงููุจูุบ</th>
                  <th>ุชูุงุตูู</th>
                </tr>
              </thead>
              <tbody id="adminOrdersBody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </section>
  </main> <!-- /container -->

  <footer style="text-align:center; padding:12px; font-size:13px; color:#999">
    &copy; 2025 ุดุฑูุฉ ุจูุช ุงูุฅุจุงุก โ ุฌููุน ุงูุญููู ูุญููุธุฉ
  </footer>

  <!-- ููุฏุงู ุชูุงุตูู ุงูุทูุจ (ููุฃุฏููู) -->
  <div id="orderModal" class="modal" hidden>
    <div class="modal__dialog" role="dialog" aria-modal="true" aria-labelledby="orderModalTitle">
      <header class="modal__header">
        <h3 id="orderModalTitle">ุชูุงุตูู ุงูุทูุจ</h3>
        <button class="modal__close" aria-label="ุฅุบูุงู">ร</button>
      </header>
      <div class="modal__body">
        <div class="meta">
          <div><strong>ุฑูู ุงูุทูุจ:</strong> <span id="m_id"></span></div>
          <div><strong>ุงูุชุงุฑูุฎ:</strong> <span id="m_date"></span></div>
          <div><strong>ุงููุดุฑูุน:</strong> <span id="m_project"></span></div>
          <div><strong>ุงููุณุชุฎุฏู:</strong> <span id="m_user"></span></div>
          <div><strong>ุงูุญุงูุฉ:</strong> <span id="m_status"></span></div>
          <div><strong>ุงููุจูุบ:</strong> <span id="m_total"></span></div>
        </div>
        <h4>ุงูุฃุตูุงู</h4>
        <div id="m_items" class="items"></div>
      </div>
      <footer class="modal__footer">
        <button class="btn" data-action="print">ุทุจุงุนุฉ</button>
        <button class="btn btn-primary modal__close">ุฅุบูุงู</button>
      </footer>
    </div>
  </div>

  <!-- ุชูุงุตูู/ุทุจุงุนุฉ ูุทูุจุงุชู (ุงูููุฏุงู ุงููุฏูู ูุฏููุ ุฃุจูููุงู ููุง ูู) -->
  <div id="detailsModal" class="modal" aria-hidden="true">
    <div class="backdrop"></div>
    <div class="modal-card printable">
      <div class="modal-header">
        <div class="inv-brand">
          <img src="img/pagelogo.png" alt="logo">
          <div class="inv-title">ูููุฐุฌ ุทูุจ ุดุฑุงุก</div>
        </div>
        <div style="display:flex; gap:8px">
          <button class="btn-strong" id="printDetailsBtn" style="padding:8px 12px;border-radius:10px">ุทุจุงุนุฉ</button>
          <button class="close-x" id="closeDetails">โ</button>
        </div>
      </div>
      <div id="detailsBody" class="t-small"></div>
    </div>
  </div>
  
    body.innerHTML = `
      <div class="inv-head">
        <div class="inv-brand">
          <img src="img/pagelogo.png" alt="logo">
          <div>
            <div class="inv-title">ุทูุจ ุดุฑุงุก</div>
            <div class="muted">ุฑูู ุงูุชุชุจูุน: <b>${r.tracking}</b></div>
          </div>
        </div>
        <div style="margin-inline-start:auto;text-align:left">
          <div>ุงููุฑุน: <b>${r.branch || '-'}</b></div>
          <div>ุงูุชุงุฑูุฎ: ${createdAtStr}</div>
        </div>
      </div>

      <div class="inv-grid" style="margin:10px 0 14px">
        <div><b>ุงุณู ุงููุดุฑูุน:</b> ${r.projectName || '-'}</div>
        <div><b>ุงุณู ุงูุนููู:</b> ${r.customerName || '-'}</div>
        <div><b>ุงูุญุงูุฉ:</b> ${statusLabel(r.status || 'created')}</div>
      </div>

      <table class="table-like">
        <thead><tr><th>#</th><th>ููุฏ ุงูุตูู</th><th>ุงููููุฉ</th><th>ุงูุณุนุฑ</th><th>ุงูุดุญู</th></tr></thead>
        <tbody>${rowsHtml}</tbody>
        <tfoot><tr><td colspan="2" class="total">ุงูุฅุฌูุงูู</td><td class="total">${qtySum}</td><td colspan="2"></td></tr></tfoot>
      </table>

      <div style="margin-top:10px">
        <b>ุงููุฑููุงุช:</b>
        ${attachHtml}
      </div>
    `;

    modal.classList.add('show');
  } catch (err) {
    console.error("openDetails error:", err);
    alert("ูุดู ุชุญููู ุชูุงุตูู ุงูุทูุจ.");
  }
}

 </script>
</body>
</html>

